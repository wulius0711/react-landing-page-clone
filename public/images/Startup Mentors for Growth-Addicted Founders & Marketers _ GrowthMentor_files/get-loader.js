(function(){"use strict";window.wisepops===void 0&&(window.wisepops=function(){window.wisepops.q.push(arguments)},window.wisepops.q=[],window.wisepops.l=Date.now());const Ve="2.1.1",te="https://notifications.wisepops.com",qt="https://wisepops.net",Wt="https://wisepops.net",zt="https://cdn.wisepops.com",Kt="https://tracking.wisepops.com",Jt="https://wisepops.net",Ee="https://wisepops.net",He="https://activity.wisepops.com",A="jvfQF9HZ7H",G="3PDq",Yt="54568",Ge="eyJwdXNoIjpudWxsLCJub3RpZmljYXRpb25zIjp7ImpzIjpudWxsLCJjc3MiOm51bGwsImZvbnQiOm51bGwsIndpc3BfaWNvbiI6bnVsbCwiZmVlZF90aXRsZSI6bnVsbCwiZ29vZ2xlX2ZvbnQiOm51bGwsInRpdGxlX2NvdW50IjpudWxsLCJ3aWRnZXRfdHlwZSI6bnVsbCwiYmVsbF9lbmFibGVkIjpudWxsLCJidXR0b25fY29sb3IiOm51bGwsIndpZGdldF9jb2xvciI6bnVsbCwid2lkZ2V0X2ltYWdlIjpudWxsLCJtb2JpbGVfcG9zaXRpb24iOm51bGwsIndpZGdldF9wb3NpdGlvbiI6bnVsbCwiZGVza3RvcF9wb3NpdGlvbiI6bnVsbCwid2lkZ2V0X2NvdW50X3RvcCI6bnVsbCwiYnV0dG9uX3RleHRfY29sb3IiOm51bGwsIndpZGdldF9pY29uX2NvbG9yIjpudWxsLCJob3Zlcl9idXR0b25fY29sb3IiOm51bGwsIndpZGdldF9jb3VudF9yaWdodCI6bnVsbCwid2lkZ2V0X3R5cGVfbW9iaWxlIjpudWxsLCJidXR0b25fYm9yZGVyX2NvbG9yIjpudWxsLCJtb2JpbGVfY3NzX3NlbGVjdG9yIjpudWxsLCJidXR0b25fYm9yZGVyX3JhZGl1cyI6bnVsbCwiZGVza3RvcF9jc3Nfc2VsZWN0b3IiOm51bGwsIndpZGdldF9leHRyYV9jb3VudF90b3AiOm51bGwsIndpZGdldF9wb3NpdGlvbl9tb2JpbGUiOm51bGwsIndpZGdldF92ZXJ0aWNhbF9vZmZzZXQiOm51bGwsImhvdmVyX2J1dHRvbl90ZXh0X2NvbG9yIjpudWxsLCJ3aWRnZXRfY291bnRfYmFja2dyb3VuZCI6bnVsbCwid2lkZ2V0X2NvdW50X3RleHRfY29sb3IiOm51bGwsIndpZGdldF9jb3VudF90b3BfbW9iaWxlIjpudWxsLCJ3aWRnZXRfZXh0cmFfY291bnRfcmlnaHQiOm51bGwsIndpZGdldF9ob3Jpem9udGFsX29mZnNldCI6bnVsbCwiaG92ZXJfYnV0dG9uX2JvcmRlcl9jb2xvciI6bnVsbCwid2lkZ2V0X2NvdW50X3JpZ2h0X21vYmlsZSI6bnVsbCwid2lkZ2V0X2V4dHJhX2NvdW50X2JhY2tncm91bmQiOm51bGx9fQ==",Xt="BJ-6ETGowvDy0CreCX__KEarfYFnvh7LuPnEMDE99FfkGaapjWqzUwk1GNIMBidfdqQki_dL_9cDvfVPZUOnvho",qe="CAMPAIGN_ENGINE,VISITOR_ID".split(","),Zt="W3siaGFzaCI6bnVsbCwidHlwZSI6bnVsbCwidHJhY2tVcmwiOm51bGwsImF0dHJpYnV0ZVJldmVudWUiOm51bGx9XQ==";typeof sessionStorage<"u"&&sessionStorage.setItem("wisepops-version",Ve);let ie;const Qt=new Uint8Array(16);function ei(){if(!ie&&(ie=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ie))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ie(Qt)}const v=[];for(let t=0;t<256;++t)v.push((t+256).toString(16).slice(1));function ti(t,e=0){return v[t[e+0]]+v[t[e+1]]+v[t[e+2]]+v[t[e+3]]+"-"+v[t[e+4]]+v[t[e+5]]+"-"+v[t[e+6]]+v[t[e+7]]+"-"+v[t[e+8]]+v[t[e+9]]+"-"+v[t[e+10]]+v[t[e+11]]+v[t[e+12]]+v[t[e+13]]+v[t[e+14]]+v[t[e+15]]}const We={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function ii(t,e,i){if(We.randomUUID&&!e&&!t)return We.randomUUID();t=t||{};const n=t.random||(t.rng||ei)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){i=i||0;for(let s=0;s<16;++s)e[i+s]=n[s];return e}return ti(n)}const T="wsp_session_";let D=null;const ni=()=>{if(typeof sessionStorage>"u")return;const t=sessionStorage.getItem(T+"id"),e=sessionStorage.getItem(T+"last_seen");t===null||e!==null&&Date.now()-parseInt(e)>30*60*1e3?D={id:ii(),lastSeen:Date.now(),referrer:document.referrer,landingURL:window.location.href,isNew:!0}:D={id:t,lastSeen:Date.now(),referrer:sessionStorage.getItem(T+"referrer")??document.referrer,landingURL:sessionStorage.getItem(T+"landing_url")??window.location.href,isNew:!1},D.isNew&&(sessionStorage.setItem(T+"id",D.id),sessionStorage.setItem(T+"referrer",D.referrer),sessionStorage.setItem(T+"landing_url",D.landingURL)),sessionStorage.setItem(T+"last_seen",D.lastSeen.toString())},si=`wisp-${te}-${G}`,ze=`wisepops-${A}-visitor`,Ke=t=>{const e=document.cookie.split(";");for(const i of e){const[n,s]=i.split("=");if(n.trim()===t)return decodeURIComponent(s.trim())}return null},oi=(t,e)=>{let i=`${encodeURIComponent(t)}=${encodeURIComponent(e)}`;i=`${i};path=/`;const n=60*60*24*365;i=`${i};max-age=${n}`,i=`${i};SameSite=Lax`,document.cookie=i},ri=()=>{var t,e,i;return((i=(e=(t=window.Shopify)==null?void 0:t.checkout)==null?void 0:e.customer_id)==null?void 0:i.toString())??null},ai=()=>{if(typeof sessionStorage>"u")return null;const t=sessionStorage.getItem(T+"id"),e=sessionStorage.getItem(T+"last_seen");return t===null||e!==null&&Date.now()-parseInt(e)>30*60*1e3?null:{id:t,referrer:sessionStorage.getItem(T+"referrer")??document.referrer,landingURL:sessionStorage.getItem(T+"landing_url")??window.location.href}},ci=()=>{if(typeof sessionStorage>"u")return null;const t=sessionStorage.getItem("wisepops_session_id");return t===null?null:{id:t,referrer:sessionStorage.getItem("wisepops_session_referrer")??document.referrer,landingURL:sessionStorage.getItem("wisepops_session_landing_url")??window.location.href}},li=t=>{typeof sessionStorage>"u"||(sessionStorage.setItem("wisepops_session_id",t.id),sessionStorage.setItem("wisepops_session_referrer",t.referrer),sessionStorage.setItem("wisepops_session_landing_url",t.landingURL))};let N=null,$=null;const di=async t=>{const e=Ke(ze)??Ke(si),i=ri(),n=ai(),o=await(await fetch(`${Ee}/id?h=${A}&vid=${e??""}&eid=${i??""}&sid=${(n==null?void 0:n.id)??""}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:JSON.stringify(t)})).json();N={id:o.id,sessionId:o.session_id},oi(ze,N.id),$=ci()??n,(!$||$.id!==N.sessionId)&&($={id:N.sessionId,referrer:document.referrer,landingURL:window.location.href},li($))};var y=(t=>(t.PAGEVIEW="PAGEVIEW",t.EXPOSURE="EXPOSURE",t.IMPRESSION="IMPRESSION",t.ENGAGEMENT="ENGAGEMENT",t.CONVERSION="CONVERSION",t))(y||{}),J=(t=>(t.POPUP="POPUP",t.NOTIFICATION="NOTIFICATION",t.PUSH="PUSH",t))(J||{});let ne=new Date().getTime().toString();typeof sessionStorage<"u"&&sessionStorage.setItem("wisepops-pageview_id",ne);const S=async(t,e={})=>{const i={type:t};if(N!==null?(i.visitorId=N.id,i.sessionId=N.sessionId,$!==null&&(i.sessionReferrer=encodeURI($.referrer),i.landingURL=encodeURI($.landingURL))):D!==null&&(i.sessionId=D.id,i.sessionReferrer=encodeURI(D.referrer),i.landingURL=encodeURI(D.landingURL)),typeof window<"u"&&(t==="PAGEVIEW"&&(ne=new Date().getTime().toString(),typeof sessionStorage<"u"&&sessionStorage.setItem(`wisepops-${A}-pageview_id`,ne)),i.pageviewId=ne,i.page=location.hostname+location.pathname,i.url=encodeURI(location.href),i.pageReferrer=encodeURI(document.referrer),i.tz=Intl.DateTimeFormat().resolvedOptions().timeZone,i.scrollY=window.scrollY,i.scrollYMax=Math.max(document.documentElement.scrollHeight,document.documentElement.offsetHeight)-window.innerHeight),i.payload=JSON.stringify(e),He.length===0){console.log(`Track ${t}`,i);return}const n=`${He}?v=${Ve}&site=${A}`;await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i),mode:"cors",credentials:"omit",cache:"no-store",redirect:"error"})};var ui="exposure",pi="impression",Je="engagement";function fi(){oe("before-tab-display",se.bind(this,ui)),oe("before-popup-display",se.bind(this,pi)),oe("after-tracked-click",se.bind(this,Je)),oe("after-form-submit",se.bind(this,Je))}function se(t,e){if(!(typeof e!="object"||typeof e.detail!="object")){var i={channel:"POPUP",event:e.type};for(var n in e.detail)Object.prototype.hasOwnProperty.call(e.detail,n)&&(i[n]=e.detail[n]);if(e.target.elements&&e.target.elements.length>0){i.elements=[];for(var s=0;s<e.target.elements.length;s++){var o=e.target.elements[s];o.name&&o.value&&i.elements.push(o.name)}}return e.detail.popup&&(e.detail.popup.campaignId?i.campaignId="wisepops_c_"+e.detail.popup.campaignId:e.detail.popup.id&&(i.campaignId="wisepops_w_"+e.detail.popup.id)),S(t,i)}}function oe(t,e,i){typeof i!="object"&&(i={}),i.passive===void 0&&(i.passive=!0),window[window.wisepops_key]("listen",t,e,void 0,i)}(function(){if(typeof window.CustomEvent=="function")return!1;function t(e,i){i=i||{bubbles:!1,cancelable:!1,detail:null};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,i.bubbles,i.cancelable,i.detail),n}window.CustomEvent=t})();function Ye(){return`wisp-${te}-${G}`}function hi(){const t=Ye(),e=document.cookie.split(";").map(i=>i.split("=").map(n=>n.trim())).find(([i])=>t===decodeURIComponent(i));return e?e[1]:null}function Xe(t,e){const i=Ye();let n=`${encodeURIComponent(i)}=${encodeURIComponent(t)}`;e.notifications.domain&&(n=`${n};domain=.${e.notifications.domain}`),n=`${n};path=/`;const s=60*60*24*365;n=`${n};max-age=${s}`,n=`${n};SameSite=Lax`,document.cookie=n}function Ze(){const t=new URLSearchParams(window.location.search),e=t.get("utm_source"),i=t.get("utm_medium"),n=t.get("utm_campaign"),s=t.get("utm_term"),o=t.get("utm_content");return!e&&!i&&!n&&!s&&!o?{}:{utm:{source:e,medium:i,campaign:n,term:s,content:o}}}async function gi(){const t=`${te}/embed/settings?website_id=${G}`;return await(await fetch(t,{headers:{Accept:"application/json"}})).json()}async function Qe(t,e,i=!1){let n=`${qt}/embed/visitor?website_id=${G}`;return t&&(n=`${n}&visitor_id=${t}`),e.client_id&&(n=`${n}&client_id=${e.client_id}`),i&&(n=`${n}&is_same_page=true`),await(await fetch(n,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:`context=${encodeURIComponent(JSON.stringify(e)).replace(/%20/g,"+")}`})).json()}function wi(){return window.innerWidth>document.documentElement.clientWidth}function _(){return window.innerWidth<=672}async function re(t,e){const i=t();return e(i)?i:(await new Promise(n=>setTimeout(n,100)),re(t,e))}function C(t){let e=!1,i;return function(...n){return e||(i=t.apply(this,n),e=!0),i}}function mi(t){let e;try{e=window[t];const i="__storage_test__";return e.setItem(i,i),e.removeItem(i),!0}catch(i){return i instanceof DOMException&&(i.code===22||i.code===1014||i.name==="QuotaExceededError"||i.name==="NS_ERROR_DOM_QUOTA_REACHED")&&e&&e.length!==0}}function Pe({tag:t="div",classList:e,style:i={},events:n={},onClick:s,...o}={},r=[]){const a=document.createElement(t);(Array.isArray(e)?e:[e]).forEach(c=>a.classList.add(c)),Object.entries(i).forEach(([c,l])=>a.style[c]=l),Object.entries(n).forEach(([c,l])=>a.addEventListener(c,l)),s&&a.addEventListener("click",s);for(const c in o)a.setAttribute(c,o[c]);return r.forEach(c=>a.appendChild(c)),a}function _i(t,{viewBox:e,classList:i,onClick:n}={}){const s=document.createElementNS("http://www.w3.org/2000/svg","svg");return s.innerHTML=t,e&&s.setAttribute("viewBox",e),i&&s.setAttribute("class",i),n&&s.addEventListener("click",n),s}function yi(t,{classList:e}={}){const i=document.createElement("iframe");return i.src=t,e&&i.classList.add(e),i}function Si(t){return document.createRange().createContextualFragment(t)}const vi=t=>{if(window.wisp.enabled)return!0;const e=_()?t.notifications.widget_type_mobile??t.notifications.widget_type??"custom":t.notifications.widget_type??"custom",i=t.notifications.bell_enabled;return document.querySelectorAll(".wisp").length>0||e==="floating"||i&&e==="dragdrop"};function et(t){const e=_()?t.notifications.widget_type_mobile??t.notifications.widget_type??"manual":t.notifications.widget_type??"manual",i=t.notifications.bell_enabled,n=document.querySelectorAll(".wisp");return n.forEach(s=>{s.classList.add("wisp_ready")}),i&&e==="dragdrop"?[tt(t,bi(t)),tt(t,Ii(t)),...Array.from(n)]:i&&e==="floating"?[it(t),...Array.from(n)]:n.length>0?n:e==="floating"?[it(t)]:[]}function bi(t){return{selector:t.notifications.desktop_css_selector,position:t.notifications.desktop_position,device:"desktop"}}function Ii(t){return{selector:t.notifications.mobile_css_selector,position:t.notifications.mobile_position,device:"mobile"}}function tt(t,e){const i=document.getElementById("wisp_floating");i&&i.parentElement.removeChild(i);const n=e.selector,s=e.position,o=t.notifications.widget_icon_color??"#FFFFFF",r=t.notifications.widget_image,a=Si(`<div
class="wisp wisp-ready wisepops-bell"
role="button"
tabindex="0"
aria-label="Notifications"
>
<div
class="wisepops-bell wisepops-device-${e.device}"
style="mask-image: url('${r}');-webkit-mask-image: url('${r}');background-color: ${o};"
/>
</div>`).children[0],c=document.querySelector(n);return c&&n&&s&&c.insertAdjacentElement(s,a),a}function it(t){const e=t.notifications.bell_enabled,i=document.getElementById("wisp_floating");i&&i.parentElement.removeChild(i);const n=t.notifications.widget_color??"#000000",s=t.notifications.widget_icon_color??"#FFFFFF",o=_()?t.notifications.widget_position_mobile??t.notifications.widget_position??"bottom_right":t.notifications.widget_position??"bottom_right",r=t.notifications.widget_horizontal_offset??0,a=t.notifications.widget_vertical_offset??0,c=t.notifications.widget_image,l=e?0:20,d=document.createElement("div");d.id="wisp_floating",d.tabIndex="0",d.role="button",d.ariaLabel="Notifications",d.classList.add("wisp","wisp_ready","wisp_floating"),d.style.backgroundColor=n,d.style.bottom=`${l+a}px`,o==="bottom_right"?d.style.right=`${l+r}px`:o==="bottom_left"&&(d.style.left=`${l+r}px`);const h=document.createElement("div");h.classList.add("wisp_icon"),c?(h.classList.add("wisp_icon_image"),h.innerHTML=`<div class="wisepops-floating-bell"
style="mask-image: url('${c}');-webkit-mask-image: url('${c}');background-color: ${s};"/>`):h.innerHTML=`
      <svg width="16" height="16" fill="${s}">
        <path d="M10 14H6c0 1.1.9 2 2 2s2-.9 2-2zM15 11h-.5c-.7-.7-1.5-1.7-1.5-3V5c0-2.8-2.2-5-5-5S3 2.2 3 5v3c0 1.3-.8 2.3-1.5 3H1c-.6 0-1 .4-1 1s.4 1 1 1h14c.6 0 1-.4 1-1s-.4-1-1-1z"/>
      </svg>
    `,d.appendChild(h);const g=document.createElement("div");return g.classList.add("wisp_close"),g.innerHTML=`
    <svg width="14" height="14" viewBox="0 0 14 14" fill="${s}">
      <path d="M13.7.3c-.4-.4-1-.4-1.4 0L7 5.6 1.7.3C1.3-.1.7-.1.3.3c-.4.4-.4 1 0 1.4L5.6 7 .3 12.3c-.4.4-.4 1 0 1.4.2.2.4.3.7.3.3 0 .5-.1.7-.3L7 8.4l5.3 5.3c.2.2.5.3.7.3.2 0 .5-.1.7-.3.4-.4.4-1 0-1.4L8.4 7l5.3-5.3c.4-.4.4-1 0-1.4z"/>
    </svg>
  `,d.appendChild(g),document.body.appendChild(d),d}function nt(t,e,i){const n=i.filter(({seen:a})=>!a).length;if(n===0)return;const s=t.notifications.title_count,o=()=>{document.querySelectorAll(".wisp_count").forEach(l=>{l.parentNode.removeChild(l)}),s&&st(0),document.querySelectorAll(".wisp").forEach(l=>{l.removeEventListener("click",o)})};e.forEach((a,c)=>{let l=a.querySelector(".wisp_count");if(!l){a.setAttribute("aria-labelledby",`wisp_count_${c}`),l=document.createElement("div"),l.classList.add("wisp_count"),l.role="status",l.id=`wisp_count_${c}`;const g=_()?t.notifications.widget_count_top_mobile??t.notifications.widget_count_top:t.notifications.widget_count_top;l.style.top=`${g??"-2"}px`;const p=_()?t.notifications.widget_count_right_mobile??t.notifications.widget_count_right:t.notifications.widget_count_right;l.style.right=`${p??"-2"}px`,l.style.background=t.notifications.widget_count_background??"#ff3b30",l.style.color=t.notifications.widget_count_text_color??"#ffffff",a.appendChild(l),a.addEventListener("click",o)}const d=`wisp-count-label-${c}`,h=`<span class="wisp_screen_reader_only" id="${d}">unread notification${n>1?"s":""}</span>`;l.innerHTML=`<span aria-labelledby="${d}" aria-live="polite">${n}</span>${h}`}),document.querySelectorAll(".wisp_extra_count").forEach(a=>{let c=a.querySelector(".wisp_count");c||(c=document.createElement("div"),c.classList.add("wisp_count"),c.style.top=`${t.notifications.widget_extra_count_top??"-8"}px`,c.style.right=`${t.notifications.widget_extra_count_right??"-8"}px`,c.style.background=t.notifications.widget_count_background??"#ff3b30",a.appendChild(c)),c.innerText=n}),s&&st(n)}let ae=null;function st(t=0){if(ae||(ae=window.document.title),!t){window.document.title=ae;return}window.document.title=`(${t}) ${ae}`}var R=(t=>(t.open="open",t.close="close",t.init="init",t.notifications="notifications",t.updatePushBannerVisibility="updatePushBannerVisibility",t.resize="resize",t))(R||{}),I=(t=>(t.resize="resize",t.loaded="loaded",t.update_height="update_height",t.feed_event="feed_event",t.redirect="redirect",t.wise_event="wise_event",t.feed_navigation="feed_navigation",t.refresh="refresh",t.init_height="init_height",t.close="close",t.reset_height="reset_height",t.subscribeToPushNotifications="subscribeToPushNotifications",t.showPushBanner="showPushBanner",t.hidePushBanner="hidePushBanner",t))(I||{});const ot="wisp";function U(t,e={}){const i=document.querySelector(".wisp_frame");i&&i.contentWindow&&i.contentWindow.postMessage({app:ot,type:t,...e},"*")}function P(t,e,i){window.addEventListener("message",n=>{const{app:s,type:o,...r}=n.data;s===ot&&o===t&&e(r)},i)}function rt(t,e){return new Promise(i=>P(t,i,e))}const ce="--dynamic",ke=`${ce}-widget-height`,V=`${ce}-rect-y-top`,le=`${ce}-rect-y-bottom`,Ei=`${ce}-widget-viewport`,at="transform 0.3s, opacity 0.3s, visibility 0.3s",Pi="transform 0.3s, opacity 0.3s, visibility 0.3s, height 0.3s, top 0.3s, left 0.3s",Oe=function(){let t;return{clear:function(){t=void 0},set:function(e){e instanceof Element&&(t=e)},focus:function(){t==null||t.focus({focusVisible:!0})}}}();async function ct(){return document.getElementById("wisp_container")!==null?!1:(document.body.appendChild(Pe({id:"wisp_container",classList:["wisp_container","wisp_container--close"],style:{transition:at}},[Pe({classList:"wisp_loader",events:{transitionend:t=>t.target.parentElement.removeChild(t.target)}},[Pe({classList:"wisp_loader_container"},[_i('<circle class="wisp_loader_path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10" />',{viewBox:"25 25 50 50",classList:"wisp_loader_circle"})])]),yi(`${Jt}/feed.html?h=${A}`,{classList:"wisp_frame"})])),_()||ki(),await rt(I.loaded),document.querySelector(".wisp_loader").classList.add("wisp_loader--hide"),!0)}const ki=C(()=>{P(I.init_height,t=>de(t.height))});let M;function lt(t){M=t[0],_()||q(M),Oi(),Ti(),Ri(),Di(),xi(),Ni(),t.forEach(e=>{e.removeEventListener("click",Te),e.addEventListener("click",Te),e.removeEventListener("keydown",dt),e.addEventListener("keydown",dt)})}function dt(t){(t.key==="Enter"||t.key===" ")&&Te(t)}function Te(t){t.preventDefault(),t.stopPropagation(),pt()?Y():Li(ut(t.target))}function ut(t){if(t.classList.contains("wisp"))return t;if(t.parentElement)return ut(t.parentElement)}const Oi=C(()=>{document.addEventListener("click",t=>{pt()&&(document.querySelector(".wisp_container").contains(t.target)||Y())})}),Ti=C(()=>{P(I.close,()=>Y())}),Di=C(()=>{P(I.update_height,({height:t})=>{_()||(de(t),q(M))})}),Ci=({height:t})=>{_()&&(de(t),q(M))},xi=C(()=>{P(I.reset_height,Ci)}),Ni=C(()=>{window.addEventListener("scroll",()=>{_()||q(M)})}),Ri=C(()=>{let t=_();window.addEventListener("resize",async()=>{if(t!==_()){const e=rt(I.refresh);U(R.resize,{isMobile:_()}),t=_();const i=await e;i.height&&de(i.height)}q(M)})});function pt(){return document.querySelector(".wisp_container").classList.contains("wisp_container--open")}function Li(t,e){M=t,Oe.set(t),_()||q(t),t.classList.add("wisp--open");const i=document.querySelector(".wisp_container");i.classList.remove("wisp_container--close"),i.classList.add("wisp_container--open"),_()&&(wi()&&document.body.classList.add("wisp_block_scrollbar"),document.body.classList.add("wisp_block")),U(R.open,{campaignId:e})}function Y(){M.classList.remove("wisp--open");const t=document.querySelector(".wisp_container");t.classList.remove("wisp_container--open");const e=()=>{t.removeEventListener("transitionend",e),!t.classList.contains("wisp_container--open")&&(U(R.close),t.classList.add("wisp_container--close"))};t.addEventListener("transitionend",e),document.body.classList.remove("wisp_block"),document.body.classList.remove("wisp_block_scrollbar"),Oe.clear()}function de(t){const e=document.querySelector(".wisp_container");e.style.transition=Pi,e.style.height=Number.isNaN(Number(t))?t:`${t}px`,e.style.setProperty(ke,e.style.height);const i=()=>{e.style.transition=at,e.removeEventListener("transitionend",i)};e.addEventListener("transitionend",i)}function Ai({containerNode:t,top:e,windowHeight:i,offset:n,height:s}){e<i/2?(t.style.setProperty(V,`${e+s+n<0?"min":"max"}(${e+s+n}px, 24px)`),t.style.setProperty(le,`min(${i-24}px, calc(var(${V}) + 100vh - 24px - ${e+s+n}px))`)):(t.style.setProperty(V,"24px"),t.style.setProperty(le,e>i?"calc(100vh - 24px))":`${e-n}px`)),t.style.setProperty(Ei,`calc(var(${le}) - var(${V}))`)}function q(t){const e=document.querySelector(".wisp_container"),i=400,n=12,s=window.innerHeight,o=window.innerWidth,{top:r,left:a,height:c,width:l}=t.getBoundingClientRect();if(r===0&&a===0&&c===0&&l===0){Y();return}const d=r>=0||r<=s||a>=0||a<=o;e.style.position=d?"fixed":"absolute";const h=d?0:window.scrollY,g=d?0:window.scrollX;if(_()){e.style.setProperty("--top",""),e.style.setProperty(V,""),e.style.setProperty(le,""),e.style.left="",e.style.top="",e.style.height="",e.classList.remove("wisp_container_top","wisp_container_bottom");return}if(Ai({top:r,windowHeight:s,offset:n,height:c,containerNode:e}),a>o/2&&r<s/2){const p=`var(${V})`;e.style.setProperty("--top",p),e.style.top=`var(--top, ${p})`,e.style.left=`${a+g+l-i}px`,e.classList.add("wisp_container_top")}else if(a>o/2&&r>s/2){const p=`calc(${r+h-n}px - var(${ke}))`;e.style.setProperty("--top",p),e.style.top=`var(--top, ${p})`,e.style.left=`${a+g+l-i}px`,e.classList.add("wisp_container_bottom")}else if(a<o/2&&r>s/2){const p=`calc(${r+h-n}px - var(${ke}))`;e.style.setProperty("--top",p),e.style.top=`var(--top, ${p})`,e.style.left=`${a+g}px`,e.classList.add("wisp_container_bottom")}else if(a<o/2&&r<s/2){const p=`var(${V})`;e.style.setProperty("--top",p),e.style.setProperty("--top",`${r+h+c+n}px`),e.style.top=`var(--top, ${p})`,e.style.left=`${a+g}px`,e.classList.add("wisp_container_top")}}var ue=(t=>(t.wisepops_display="wisepops_display",t.wisepops_click="wisepops_click",t.wisepops_form_submit="wisepops_form_submit",t.wisepops_open_feed="wisepops_open_feed",t.wisepops_see_notification="wisepops_see_notification",t.wisepops_click_notification="wisepops_click_notification",t.wisepops_complete_notification="wisepops_complete_notification",t))(ue||{}),pe=(t=>(t.email="email",t.phone="phone",t.survey="survey",t))(pe||{});const $i={wisepops_display:"Display",wisepops_click:"Click",wisepops_form_submitemail:"Signup",wisepops_form_submitphone:"Phone",wisepops_form_submitsurvey:"Survey completion"},ft=function(){const t=[];if(typeof window.dataLayer=="object"&&window.dataLayer!==null){const e=window.google_tag_manager;if(typeof e=="object"&&e!==null)for(const i in e){const n=e[i];typeof n=="object"&&n!==null&&typeof n.dataLayer=="object"&&n.dataLayer!==null&&t.push(i)}}return t},Ui=function(){const t=ft();for(const e of t)if(/^G-[A-Z0-9]{7,20}$/.test(e))return!0;return!1},Mi=t=>Object.prototype.toString.call(t)==="[object Arguments]",Bi=()=>{var t;return typeof window.gtag=="function"&&((t=window.dataLayer)==null?void 0:t.some(e=>{if(!Mi(e))return!1;const i=e;return i.length>=2&&typeof i[0]=="string"&&i[0]==="config"&&typeof i[1]=="string"&&i[1].startsWith("G-")}))},fe=function(t,e){const i=window[window.GoogleAnalyticsObject||"ga"],n=$i[t+(e.form_type||"")]||t,s={...e};if(typeof window.gtag<"u"&&Bi())window.gtag("event",t,{...s,non_interaction:!0});else if(Ui()){const o={event:t};let r;for(r in s){const a=s[r];o[`wisepops_${r}`]=typeof a=="string"?a:JSON.stringify(a)}window.dataLayer&&window.dataLayer.push(o)}typeof i=="function"&&typeof i.getAll=="function"?i(()=>{const o=[],r=typeof window.gtag=="function"?ft():[];i.getAll().forEach(a=>{const c=a.get("trackingId");!o.includes(c)&&!r.includes(c)&&(o.push(a.get("trackingId")),i(a.get("name")+".send","event","WisePops",n,e.label,{nonInteraction:!0}))})}):window._gaq&&typeof window._gaq.push=="function"&&typeof window.gtag!="function"&&window._gaq.push(["_trackEvent","WisePops",n,e.label,void 0,!0])},Fi=["open_feed","see_notification","click_notification","complete_notification"],ht=C(()=>{P(I.feed_event,({event:t,data:e})=>{if(Fi.indexOf(t)!==-1){const i={};e.campaign_name&&(i.campaign_name=e.campaign_name),fe(`wisepops_${t}`,i)}t==="complete_notification"&&ji(e.payload)})});function ji({email:t}={}){if(!t)return;(window._learnq??[]).push(["identify",{$email:t,$source:"wisp"}])}const Vi=`.wisp{position:relative;cursor:pointer}:where(.wisp:focus-visible){outline:2px solid #AE8FF1}.wisepops-bell,.wisepops-floating-bell,.wisepops-bell:empty,.wisepops-floating-bell:empty{display:block;height:24px;width:24px;mask-size:24px 24px;-webkit-mask-size:24px 24px}@media (max-width: 672px){.wisepops-device-mobile{display:block}.wisepops-device-desktop{display:none}}@media (min-width: 673px){.wisepops-device-mobile{display:none}.wisepops-device-desktop{display:block}}.wisp_floating{position:fixed;height:56px;width:56px;border-radius:100%;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 4px #00000040;z-index:9999997}.wisp_floating .wisp_count{height:19px;width:19px;line-height:19px}.wisp_floating .wisp_icon{display:flex;opacity:100;transition:opacity .3s}.wisp_floating .wisp_icon_image img{height:32px;width:32px;object-fit:cover}.wisp_floating .wisp_close{display:flex;position:absolute;top:21px;left:21px;opacity:0;transform:rotate(0);transition:opacity .3s,transform .3s}.wisp--open .wisp_icon{opacity:0}.wisp--open .wisp_close{opacity:100;transform:rotate(90deg)}.wisp_count{position:absolute;height:15px;width:15px;border-radius:100%;color:#fff;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-size:10px;font-weight:700;letter-spacing:normal;text-align:center;line-height:15px;cursor:pointer;-webkit-user-select:none;user-select:none}.wisp_screen_reader_only{position:absolute!important;overflow:hidden;opacity:0;pointer-events:none;height:0;width:0}.wisp_extra_count{position:relative}.wisp_container{position:fixed;width:400px;border-radius:4px;background-color:#fff;box-shadow:0 8px 16px #00000014;z-index:9999998;overflow:hidden;opacity:0;box-sizing:border-box;-webkit-user-select:none;user-select:none}.wisp_container_top{transform:translateY(-12px)}.wisp_container_bottom{transform:translateY(12px)}.wisp_container--open{opacity:100;visibility:visible;transform:translateY(0)}.wisp_container--close{width:0px;visibility:hidden}@media (max-width: 672px){.wisp_container{top:0px;left:0px;height:100%;width:100%;border:0;border-radius:0}}.wisp_container .wisp_frame{height:100%;width:100%;border:0}.wisp_container .wisp_loader{position:absolute;top:0;left:0;right:0;bottom:0;background-color:#fff;display:flex;align-items:center;justify-content:center;pointer-events:none;transition:opacity .3s}.wisp_container .wisp_loader--hide{opacity:0}.wisp_container .wisp_loader .wisp_loader_container{position:relative;height:56px;width:56px}.wisp_container .wisp_loader .wisp_loader_container .wisp_loader_circle{animation:wisp_loader_rotate 2s linear infinite}.wisp_container .wisp_loader .wisp_loader_container .wisp_loader_circle .wisp_loader_path{stroke:#3336;animation:wisp_loader_dash 1.5s ease-in-out infinite}@keyframes wisp_loader_rotate{to{transform:rotate(360deg)}}@keyframes wisp_loader_dash{0%{stroke-dasharray:1,200;stroke-dashoffset:0}50%{stroke-dasharray:89,200;stroke-dashoffset:-35px}to{stroke-dasharray:89,200;stroke-dashoffset:-124px}}.wisp_block{overflow:hidden}.wisp_block.wisp_block_scrollbar{padding-right:15px}
`,gt={mobile:"max-width: 672px",desktop:"min-width; 673px"},Hi=`
    @media (${gt.mobile}){
        .wisepops-desktop {
            display: none;
        }
    }

    @media (${gt.desktop}){
        .wisepops-mobile {
            display: none;
        }
    }
`;function Gi(){H({event:"feed_exposure",time:Math.floor(Date.now()/1e3)}),S(y.EXPOSURE,{channel:"NOTIFICATION"})}function qi(t,e){H({event:"open_feed",time:Math.floor(Date.now()/1e3),notification_count:t,new_notification_count:e}),document.dispatchEvent(new CustomEvent("wisp_event",{detail:{event:"open_feed",data:{notification_count:t,new_notification_count:e}}})),S(y.IMPRESSION,{channel:"NOTIFICATION",target:"feed",event:"open_feed",notification_count:t,new_notification_count:e})}function Wi(t,e,i){H({event:"see_notification",time:Math.floor(Date.now()/1e3),campaign_id:t,position:e}),document.dispatchEvent(new CustomEvent("wisp_event",{detail:{event:"see_notification",data:{campaign_id:t,position:e}}})),S(y.IMPRESSION,{channel:"NOTIFICATION",event:"see_notification",campaignId:`wisp_${t}`,position:e}),i.recommendation&&S(y.EXPOSURE,{channel:"RECO",event:"see_notification"})}function zi({recommendation:t,notification:{position:e,campaignId:i}}){S(y.ENGAGEMENT,{channel:"RECO",event:"open_reco",...t}),S(y.ENGAGEMENT,{channel:"NOTIFICATION",event:"complete_notification",campaignId:`wisp_${i}`,position:e,productId:t.product.id}),H({event:"complete_notification",time:Math.floor(Date.now()/1e3),campaign_id:i,position:e,product_id:t.product.id},!0)}function Ki(t){S(y.IMPRESSION,{channel:"RECO",event:"see_product",...t})}function Ji(t){S(y.IMPRESSION,{channel:"RECO",event:"open_feed",...t})}function Yi(t,e,i={}){H({event:"click_notification",time:Math.floor(Date.now()/1e3),campaign_id:t,position:e}),document.dispatchEvent(new CustomEvent("wisp_event",{detail:{event:"click_notification",data:{campaign_id:t,position:e,...i}}})),S(y.IMPRESSION,{channel:"NOTIFICATION",event:"click_notification",campaignId:`wisp_${t}`,position:e,...i})}function Xi(t,e,i=null){H({event:"complete_notification",time:Math.floor(Date.now()/1e3),campaign_id:t,position:e,payload:i},!0),document.dispatchEvent(new CustomEvent("wisp_event",{detail:{event:"complete_notification",data:{campaign_id:t,position:e,payload:i}}})),S(y.ENGAGEMENT,{channel:"NOTIFICATION",event:"complete_notification",campaignId:`wisp_${t}`,elements:i!=null&&i.email?["email"]:void 0,position:e})}function Zi(t){t!=null&&(typeof t!="object"&&(t={value:t}),H({event:"goal",time:Math.floor(Date.now()/1e3),...t},!0),document.dispatchEvent(new CustomEvent("wisp_event",{detail:{event:"goal",data:t}})))}const H=(()=>{let t=[],e=null,i=!1;return(n,s=!1)=>{if(t=[...t,n],e&&(clearTimeout(e),e=null),s){const o=[...t];t=[],De(o);return}e=setTimeout(()=>{const o=[...t];t=[],e=null,De(o)},1e3),i||(i=!0,window.addEventListener("beforeunload",()=>{if(t.length===0)return;const o=[...t];t=[],De(o)}))}})();async function De(t){const e=new URLSearchParams;e.append("website_id",G),e.append("visitor_id",window.wisp.config.visitorId),await fetch(`${te}/embed/events?${e.toString()}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:`events=${encodeURIComponent(JSON.stringify(t)).replace(/%20/g,"+")}`}),document.dispatchEvent(new CustomEvent("wisp_sync_events"))}const wt="push_hide_until";function Qi(){if(!mi("localStorage"))return!0;const t=localStorage.getItem(wt);if(t===null)return!0;if(t==="never")return!1;const e=new Date(parseInt(t));return isNaN(e.getTime())||Date.now()>e.getTime()}function mt(){Qi()&&U(R.updatePushBannerVisibility,{visible:!0})}function Ce({keepHiddenDaysAmount:t}={keepHiddenDaysAmount:null}){let e="never";if(typeof t=="number"){const i=new Date;i.setDate(i.getDate()+t),e=i.getTime()}localStorage.setItem(wt,`${e}`),U(R.updatePushBannerVisibility,{visible:!1})}const _t=C(()=>{P(I.redirect,({url:t,target:e})=>{e==="_parent"?window.location.href=t:e==="_blank"&&window.open(t)}),P(I.feed_event,({event:t,data:e})=>{switch(t){case"open_feed":qi(e.notification_count,e.new_notification_count),e.has_push_enabled&&S(y.EXPOSURE,{channel:J.PUSH,target:"subscribe_request"});break;case"open_recommendations_feed":Ji({reco_count:e.recommendations_count});break;case"see_recommendation_product":Ki({product:e.product,position:e.position});break;case"open_recommendation_product":zi({recommendation:{product:e.product,position:e.position},notification:{campaignId:e.notification.campaignId,position:e.notification.position}});break;case"see_notification":Wi(e.campaign_id,e.position,e.details);break;case"click_notification":Yi(e.campaign_id,e.position,e.details);break;case"complete_notification":Xi(e.campaign_id,e.position,e.payload);break}}),P(I.wise_event,({event:t,data:e})=>{switch(t){case"complete_notification":window.wisepops&&(wisepops("properties",{notificationId:e.campaign_id},{temporary:!0}),wisepops("event","notification-complete"));break}}),P(I.feed_navigation,({event:t})=>{switch(t){case"focus_trigger":Oe.focus(),Y()}}),P(I.hidePushBanner,Ce),P(I.showPushBanner,mt)}),yt=async()=>{const{clientId:t,productId:e,variantId:i}=en();let n=await nn(e,i);t&&(n={...n,client_id:t});const s=tn();return s&&window.wisp.goal(s),sn(),n};function en(){var n,s,o;const t=(n=Shopify==null?void 0:Shopify.checkout)==null?void 0:n.customer_id,e=((o=(s=ShopifyAnalytics==null?void 0:ShopifyAnalytics.meta)==null?void 0:s.product)==null?void 0:o.id)??"",i=new URLSearchParams(window.location.search).get("variant")??"";return{clientId:t,productId:e,variantId:i}}function tn(){var n,s,o;const t=(n=Shopify==null?void 0:Shopify.Checkout)==null?void 0:n.page;if(!t||t.indexOf("thank_you")<0)return;const e=(s=Shopify==null?void 0:Shopify.checkout)==null?void 0:s.total_price,i=(o=Shopify==null?void 0:Shopify.checkout)==null?void 0:o.order_id;if(e!=null)return{value:parseFloat(e),order_id:i}}async function nn(t,e){var n;const i=(n=document.currentScript)!=null&&n.src.includes("website_id")?`/tools/wisp/context/${t}/${e}`:`/a/wisepops/context/${t}/${e}`;try{return await(await fetch(i)).json()}catch{return console.log("Wisepops: Failed to fetch the Shopify context"),{}}}const sn=C(()=>{const t=["Added Product"],e=ShopifyAnalytics&&ShopifyAnalytics.lib&&ShopifyAnalytics.lib.track;e&&(ShopifyAnalytics.lib.track=function(...i){const[n]=i;t.includes(n)&&window.wisp.update(),e.apply(this,i)})});let k={};if(Ge.length>0)try{k=JSON.parse(atob(Ge))}catch{console.error("Failed to parse Wisepops settings"),k={}}const St=C(async(t,e)=>{var o;if(!(((o=k==null?void 0:k.push)==null?void 0:o.enabled)??!1))return;if(!("serviceWorker"in navigator)){console.error("serviceWorker is not supported");return}if(!("PushManager"in window)){console.error("PushManager is not supported");return}if(Notification.permission==="denied")return;let i;const n=e?"/a/wisepops/serviceWorker.js":"/serviceWorker.js";try{i=await navigator.serviceWorker.register(`${n}?h=${A}`)}catch{console.error("Failed to register Wisepops service worker");return}if(Notification.permission==="granted")return;mt();let s=!1;P(I.subscribeToPushNotifications,async()=>{if(s)return;s=!0,S(y.IMPRESSION,{channel:J.PUSH,target:"subscribe_request"});let r="default";try{r=await on()}catch{}if(r==="default"){s=!1;return}if(r==="denied"){Ce(),S(y.ENGAGEMENT,{channel:J.PUSH,target:"subscribe_request",subscribed:!1});return}S(y.ENGAGEMENT,{channel:J.PUSH,target:"subscribe_request",subscribed:!0}),Ce(),await an(i,t)})});function on(){return new Promise((t,e)=>{const i=Notification.requestPermission(n=>t(n));i&&i.then(t,e)})}function rn(t){const e="=".repeat((4-t.length%4)%4),i=(t+e).replace(/-/g,"+").replace(/_/g,"/"),n=window.atob(i),s=new Uint8Array(n.length);for(let o=0;o<n.length;++o)s[o]=n.charCodeAt(o);return s}async function an(t,e){const i=await t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:rn(Xt)});await fetch(`${Ee}/subscriptions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({websiteId:G,visitorId:e,subscription:i})})}const cn=t=>typeof t=="string"?t:t.handle,ln=async t=>{var n,s;const e=((s=(n=window.Shopify)==null?void 0:n.routes)==null?void 0:s.root)??"/",i=await fetch(`${e}products/${t}.js`);if(i.ok)return i.json()},dn=async t=>{const e=t.map(ln);return(await Promise.allSettled(e)).filter(n=>(n==null?void 0:n.status)==="fulfilled")},un=async t=>(await dn(t)).map(i=>({handle:i.value.handle,featured_image:i.value.featured_image,price:i.value.price,title:i.value.title,url:i.value.url,id:i.value.id})),pn=(()=>{const t="wisepops_recommendation_products";let e=JSON.parse(sessionStorage.getItem(t))??{};const i=n=>{sessionStorage.setItem(t,JSON.stringify(n)),e=n};return async n=>{const s=n.map(cn),o=s.filter(c=>!e[c]),r=await un(o),a=s.reduce((c,l)=>{const d=r.find(({handle:h})=>l===h)??e[l];return d&&(c[l]=d),c},{});return i({...e,...a}),a}})(),vt=()=>{const t="wisp_embed_style";if(document.getElementById(t)!==null)return;const e=document.createElement("style");e.id=t,e.innerHTML=`${Vi};${Hi}`,document.head.appendChild(e)},bt=t=>Promise.all(t.map(async e=>{var i;return(i=e.products)!=null&&i.length&&(e.products=await pn(e.products).then(n=>Object.values(n))),e}));async function fn(){var a,c;if(window.wisp.started)return;window.wisp.started=!0;let t=!1,e={};if(window.Shopify){const l=await yt();e={...e,...l},t=!0}Object.keys(k).length===0&&(k.notifications=await gi()),await re(()=>vi(k),l=>l),window.wisp.enabled=!0,vt();const i=N!==null?N.id:hi(),[{visitor_id:n,notifications:s}]=await Promise.all([Qe(i,{...e,...Ze(),url:window.location.href}),ct()]),o=await bt(s);Xe(n,k),window.wisp={...window.wisp,ready:!0,config:{visitorId:n,settings:k},context:e,notifications:o};const r=await re(()=>et(k),l=>l.length>0);Gi(),lt(r),nt(k,r,o),_t(),U(R.init,{visitorId:n,settings:k,notifications:o,isMobile:_(),host:window.location.host,currency:(a=window.Shopify)==null?void 0:a.currency,locale:((c=window.Shopify)==null?void 0:c.locale)??"en"}),ht(),St(n,t)}async function hn(t={}){var c,l;if(window.wisp.ready===!1){setTimeout(()=>window.wisp.update(t),100);return}window.wisp.ready=!1;const{visitorId:e,settings:i}=window.wisp.config;if(window.Shopify){const d=await yt();t={...t,...d}}vt();const[{visitor_id:n,notifications:s},o]=await Promise.all([Qe(e,{...t,...Ze(),url:window.location.href}),ct()]),r=await bt(s);Xe(n,i),window.wisp={...window.wisp,ready:!0,config:{...window.wisp.config,visitorId:n},context:t,notifications:r};const a=await re(()=>et(i),d=>d.length>0);lt(a),nt(i,a,r),_t(),ht(i),St(i),o?U(R.init,{visitorId:n,settings:i,notifications:r,isMobile:_(),host:window.location.host,currency:(c=window.Shopify)==null?void 0:c.currency,locale:((l=window.Shopify)==null?void 0:l.locale)??"en"}):U(R.notifications,{notifications:r})}function gn(t){if(window.wisp.ready===!1){window.wisp.enabled=!0,setTimeout(()=>window.wisp.goal(t),100);return}Zi(t)}window.wisp||(window.wisp={started:!1,ready:!1,enabled:!1,config:{visitorId:null,settings:null},context:null,notifications:null,update:hn,goal:gn,debug(){console.log(`
Visitor Id: ${this.config.visitorId}
Settings: ${JSON.stringify(this.config.settings,null,2)}
Context: ${JSON.stringify(this.context,null,2)}
Notifications: ${JSON.stringify(this.notifications,null,2)}
      `)},start:(t,e,i)=>{i&&window.wisp.update(i)},newPage:(t={})=>{window.wisp.update(t)},updateContext:(t={})=>{window.wisp.update(t)}});const b={cookieMaxSizeMax:1024*3,cookieMaxSizeMin:512,cookieTTLMax:365*2,cookieTTLMin:2,loggerMaxSize:1e3,msInDay:24*60*60*1e3,msIn30Days:30*24*60*60*1e3,visitsMaxSize:10};var w=(t=>(t.persistent="wisepops",t.session="wisepops_session",t.properties="wisepops_props",t.visits="wisepops_visits",t.noShow="wisepops_noshow",t))(w||{});const X=Yt,It=A,he={popup:Wt,cdn:zt,tracking:Kt},xe=["e","p","s"],wn=xe.concat(["c"]);var u=(t=>(t.none="none",t.error="error",t.warn="warn",t.info="info",t.debug="debug",t.trace="trace",t))(u||{});const Ne=["none","error","warn","info","debug","trace"],Re=class Gt{constructor(){this.displayLevel=null,this.logs=[]}static getInstance(){return Gt.instance}log(e,i,n){const s=e in u?e:"info",o={level:Ne.indexOf(s),msg:i,prop:n};this.logs.length<b.loggerMaxSize&&this.logs.push(o),this.display(o)}displayAll(e="info"){this.displayLevel=e in u?e:"info",this.logs.forEach(this.display.bind(this))}display(e){if(this.displayLevel!==null){const i=Ne.indexOf(this.displayLevel),n=window.console[Ne[e.level]];if(e.level<=i&&n){const s="WisePops - "+e.msg;e.prop?n(s,e.prop):n(s)}}}};Re.instance=new Re;let B=Re;var mn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Et={};(function(t){(function(e){function i(n){for(var s=n.length,o,r;s!==0;)r=Math.floor(Math.random()*s),s-=1,o=n[s],n[s]=n[r],n[r]=o;return n}e.knuthShuffle=i})(t||typeof window<"u"&&window||mn)})(Et);var W=(t=>(t.AFTER_INITIALIZATION="after-initialization",t.BEFORE_TAB_DISPLAY="before-tab-display",t.BEFORE_POPUP_DISPLAY="before-popup-display",t.BEFORE_FORM_SUBMIT="before-form-submit",t.AFTER_FORM_SUBMIT="after-form-submit",t.BEFORE_TRACKED_CLICK="before-tracked-click",t.AFTER_TRACKED_CLICK="after-tracked-click",t.AFTER_POPUP_CLOSE="after-popup-close",t))(W||{}),F=(t=>(t.POPUP="popup",t.BAR="bar",t.EMBED="embed",t.STICKY="sticky",t))(F||{});function Pt(t,e=window.location.hostname){let i=t;if(t){const n=e.match(/[a-z0-9][a-z0-9\-]+\.[a-z.]{2,6}$/i);n&&n[0]?e=n[0]:i=!1}return{hostname:e,subDomainSkipped:i}}function kt(t,e=window.location.search.substr(1)){const i=e.split("&");for(let n=0;n<i.length;n++){const s=i[n].split("=");if(s[0]=decodeURIComponent(s[0]),s[0]===t&&s[1])return decodeURIComponent(s[1])}return null}function ge(t){const e=t+"=",i=document.cookie.split(";");for(let n=0;n<i.length;n++){let s=i[n];for(;s.charAt(0)===" ";)s=s.substring(1);if(s.indexOf(e)===0)return s=s.substring(e.length,s.length),s.charAt(0)==="{"||s.charAt(0)==="["?s=unescape(s):s=decodeURIComponent(s),s}return null}function _n(t,e,i,n,s,o=b.cookieMaxSizeMax){const r=`${t}=${encodeURIComponent(e)}; `,a=i?`path=${i}; `:"",c=n?`domain=${n}; `:"",l="samesite=lax; ",d=s?`expires=${s.toUTCString()}`:"",h=r+a+c+l+d;if(h.length>o)throw new Error("Cookie is too big ("+t+")");document.cookie=h}function yn(t,e,i){const n=i?window.sessionStorage:window.localStorage;return n?(n.setItem(t,e),!0):!1}function Sn(t){window.localStorage&&window.localStorage.removeItem(t),window.sessionStorage&&window.sessionStorage.removeItem(t)}function Ot(t){const e=t===w.session?window.sessionStorage:window.localStorage;return e?e.getItem(t):null}function Tt(t){return Object.keys(t).map(e=>t[e]).filter(e=>typeof e=="string")}function vn(t){if(typeof t!="string")throw new Error("Device has not been detected yet");return t.indexOf("phone_")===0}function bn(t){if(typeof t!="string")throw new Error("Device has not been detected yet");return t.indexOf("tablet_")===0}function Dt(t,e="",i={}){for(const n in t)if(t.hasOwnProperty(n)){const s=e?e+"."+n:n;t[n]instanceof Object?Dt(t[n],s,i):i[s]=t[n]}return i}function In(t){let e=new Date(t);if(e.toString()!=="Invalid Date"||(e=new Date(parseInt(t,10)),e.toString()!=="Invalid Date"))return e}const z=B.getInstance();var Ct=(t=>(t.source="source",t.medium="medium",t.campaign="campaign",t.term="term",t.content="content",t.gclid="gclid",t))(Ct||{}),Le=(t=>(t.step="s",t.formSession="i",t.uniqueCoupon="c",t))(Le||{});const xt=class x{constructor(){this.persistentData={csd:1,popups:{},sub:0,ucrn:null,cid:null,v:x.STORAGE_VERSION,bandit:{recos:{}}},this.sessionData={arrivalOnSite:null,mtime:null,pageviews:0,popups:{},bars:{},sticky:{},countdowns:{},src:null,utm:{},testIp:null},this.customProperties={},this.temporaryCustomProperties={},this.visits=[],this.noShow=null,this.browserStorageUsed=!1,this.arrivalOnPage=null,this.device=null,this.trafficChannel=null,this.location={country:null,region:null,city:null},this.ip="",this.cookies={ttl:b.cookieTTLMax,maxSize:b.cookieMaxSizeMax},this.banditEventIds={},this.banditIds={},this.getCookie=ge,this.autoPageview=!0,this.initBrowserStorageUsed(),this.initStored(),this.initSession(),this.initCustomProperties(),this.initVisits(),this.initNoShow(),this.initExternalSubscribed(),this.migrateCookieFormat()}static isSessionCookieRecent(e,i){const n=e&&e.getTime();return(n?i-n:0)<2*60*60*1e3}static getInstance(){return x.instance||(x.instance=new x),x.instance}static isNoShowDateReached(e,i){return e.getTime()<i}initStored(){let e=this.getStorage(w.persistent);if(e)try{const i=JSON.parse(e);i.cid&&i.cid!==X&&z.log(u.error,"Conflict between accounts: "+i.cid+"/"+X),i.cid=X,i.v||(i.v=0),this.persistentData={...this.persistentData,...i}}catch{z.log(u.error,"Cookie format corrupted"),e=null}e||(this.persistentData.cid=X,this.generateUcrn()),this.saveStored(),!this.isBrowserStorageUsed()&&!this.getCookie(w.persistent)&&this.getCrossSubDomain()&&(this.setCrossSubDomain(!1),this.initStored())}isBrowserStorageUsed(e){return e?!!Ot(w.persistent):this.browserStorageUsed}setBrowserStorageUsed(e,i){const n=e!==this.browserStorageUsed;if(n&&i){if(!this.testStorage())throw new Error("Storage engine not available");this.removeStorage(w.persistent),this.removeStorage(w.session),this.removeStorage(w.properties),this.removeStorage(w.visits),this.removeStorage(w.noShow)}return this.browserStorageUsed=e,n&&i&&this.save(),n}setCookiesMaxSize(e){this.cookies.maxSize=e,this.save()}setCookiesTTL(e){this.cookies.ttl=e,this.save()}setAutoPageView(e){this.autoPageview=e}getAutoPageView(){return this.autoPageview}setRecaptchaSiteKey(e){this.recaptchaSiteKey=e}getRecaptchaSiteKey(){return this.recaptchaSiteKey}getPopupIds(){return Object.keys(this.persistentData.popups).map(e=>parseInt(e,10))}getSessionPopups(){return this.sessionData.popups}getSessionBars(){return this.sessionData.bars}getSessionStickyTabs(){return Object.keys(this.sessionData.sticky)}setTimerStarted(e){const i=this.getTimerStartedAt(e);if(i)return i;const n=new Date;return this.sessionData.countdowns[e]=n.getTime(),this.saveSession(),n}getTimerStartedAt(e){const i=this.sessionData.countdowns[e];return i?new Date(i):void 0}setCustomProperties(e,i){typeof i=="object"&&i.temporary?this.temporaryCustomProperties=this.getMergedCustomProperties(this.temporaryCustomProperties,e):typeof i=="boolean"&&i?this.customProperties=e:this.customProperties=this.getMergedCustomProperties(this.customProperties,e),this.saveCustomProperties()}isPageReloaded(){var e,i;return((i=(e=window.performance)==null?void 0:e.getEntriesByType("navigation")[0])==null?void 0:i.type)==="reload"}isReferrerExternal(e=document.referrer,i){if(this.isPageReloaded())return!1;if(e!==""){const n=Pt(this.getCrossSubDomain(),i).hostname,s=document.createElement("a");return s.href=e,s.hostname.indexOf(n)===-1}return!0}getSourceDomain(){const e=this.getSource();if(e&&e!==""){const i=document.createElement("a");return i.href=e,i.hostname}return null}getSource(){return this.sessionData.src}getDoNotDisplay(){return!!this.noShow}getDisplayCount(e){const i=this.getPopup(e);return i&&i.dc?i.dc:0}getLastDisplayedInterval(e){const i=this.getPopup(e);if(i){const n=Math.abs(new Date(i.d).getTime()-new Date().getTime());return Math.floor(n/1e3/60)}else return 0}setDisplayed(e,i){const n=new Date().getTime(),s=this.getPopup(e);return s?(s.dc++,s.d=n):this.persistentData.popups[e]={dc:1,d:n},this.saveStored(),this.addSessionPopupId(e,i),!0}setClosed(e){const i=this.getPopup(e);return i?i.cl=1:this.persistentData.popups[e]={dc:1,d:new Date().getTime(),cl:1},this.saveStored(),!0}enableStickyTab(e){return this.sessionData.sticky[e]={},this.saveSession(),!0}disableStickyTab(e){return delete this.sessionData.sticky[e],this.saveSession(),!0}getStickyTab(e){return this.sessionData.sticky[e]||null}isStickyTab(e){return this.getStickyTab(e)!==null}setStickyTabFormSession(e,i){const n=this.getStickyTab(e);return n?(n.i=i,this.saveSession(),!0):!1}getStickyTabFormSession(e){var i;return((i=this.getStickyTab(e))==null?void 0:i.i)??null}setStickyTabStep(e,i){const n=this.getStickyTab(e);return n?(n.s=i,this.saveSession(),!0):!1}getStickyTabStep(e){var i;return((i=this.getStickyTab(e))==null?void 0:i.s)??null}getStickyTabUniqueCoupon(e){var i;return((i=this.getStickyTab(e))==null?void 0:i.c)??null}setStickyTabUniqueCoupon(e,i){const n=this.getStickyTab(e);return n?(n.c=i,this.saveSession(),!0):!1}getStickyTabData(e,i){const n=Le[i]||i;return(this.getStickyTab(e)||{})[n]??null}setStickyTabData(e,i,n){const s=this.getStickyTab(e);if(!s)return!1;const o=Le[i]||i;return s[o||i]=n,this.saveSession(),!0}isClosed(e){const i=this.getPopup(e);return!!(i&&i.cl)}isConverted(e){const i=this.getPopup(e);return!!(i&&i.c)}setConverted(e){const i=this.getPopup(e);if(i){const n=new Date;return i.c=n.getTime(),this.saveStored(),!0}else return!1}setTrafficChannel(e){this.trafficChannel=e}getTrafficChannel(){return this.trafficChannel}hasAnySubscription(){return!!this.persistentData.sub}setArrivalOnPage(e){const i=new Date;!this.arrivalOnPage&&e&&i.setTime(e),this.arrivalOnPage=i}getArrivalOnPage(){return this.arrivalOnPage||this.setArrivalOnPage(),this.arrivalOnPage}getUtmParameters(){return this.sessionData.utm}getVisits(){return this.visits}addVisit(){(this.isReferrerExternal()||!this.visits.length)&&(this.visits.unshift(this.getArrivalOnPage().toJSON())>b.visitsMaxSize&&(this.visits=this.visits.slice(0,b.visitsMaxSize)),this.saveVisits())}getPageViewCount(){return this.sessionData.pageviews}incrementPageViewCount(e){this.isReferrerExternal()&&!e?this.sessionData.pageviews=1:this.sessionData.pageviews++,this.saveSession()}getTestIp(){return this.sessionData.testIp}setTestIp(e){this.sessionData.testIp=e,this.saveSession()}incrementSessionPagesElapsed(){this.incrementSessionPagesElapsedForType("popups"),this.incrementSessionPagesElapsedForType("bars"),this.saveSession()}getCustomProperties(e){const i=this.getMergedCustomProperties({},this.customProperties),n=this.getMergedCustomProperties(i,this.temporaryCustomProperties);for(const s in n)if(n.hasOwnProperty(s))return e?{...Dt(n)}:{...n};return{}}getUcrn(){return this.persistentData.ucrn===void 0||this.persistentData.ucrn===null?!1:this.persistentData.ucrn}getLastDisplayedAndConvertedPopups(){let e=null,i=null,n=null,s=null,o=null;return this.getPopupIds().forEach(r=>{const a=this.getPopup(r);a&&(o=new Date(a.d),(i===null||o.getTime()>i.getTime())&&(e=r,i=o),a.c&&(o=new Date(a.c),(s===null||o.getTime()>s.getTime())&&(n=r,s=o)))}),{displayPopId:e,displayDate:i,convertPopId:n,convertDate:s}}setSubscribed(e){return this.getPopup(e)?(this.persistentData.sub=1,this.saveStored(),!0):!1}getDebugData(){return{persistentData:this.persistentData,sessionData:this.sessionData,customProperties:this.customProperties,visits:this.visits,browserStorageUsed:this.browserStorageUsed,arrivalOnPage:this.arrivalOnPage,noShow:this.noShow,baseUrl:he,cookies:{...this.cookies,names:w},location:{...this.location}}}setArrivalOnSite(){(!this.sessionData.arrivalOnSite||this.isReferrerExternal())&&(this.sessionData.arrivalOnSite=this.getArrivalOnPage().toJSON())}getArrivalOnSite(){return this.sessionData.arrivalOnSite||this.setArrivalOnSite(),new Date(this.sessionData.arrivalOnSite)}setDevice(e){this.device=e}setUserLocation(e){this.location=e}getUserLocation(){return this.location}setUserIp(e){this.ip=e}getUserIp(){return this.ip}isPhoneDevice(){return vn(this.device)}isTabletDevice(){return bn(this.device)}setRecommendationId(e,i){this.persistentData.bandit.recos[e]=i}getRecommendationId(e){return this.persistentData.bandit.recos[e]||null}getAllRecommendations(){return this.persistentData.bandit.recos}setBanditEventId(e,i){this.banditEventIds[e]=i}getBanditEventId(e){return this.banditEventIds[e]}setBanditId(e,i){this.banditIds[e]=i}getBanditId(e){return this.banditIds[e]}setDoNotDisplay(e=!0){if(e){const i=new Date;i.setTime(i.getTime()+b.msIn30Days),this.noShow=i}else this.noShow=null;this.saveNoShow()}getExternalSegments(){return this.sessionData.es}setExternalSegments(e){this.sessionData.es=e,this.saveSession()}getKlaviyoExchangeId(){let e=null;const i=ge("__kla_id");if(i)try{const n=JSON.parse(atob(i));n.$exchange_id&&(e=n.$exchange_id)}catch{}return e}getPopup(e){return this.persistentData.popups[e]}getMergedCustomProperties(e,i){for(const n in i)i.hasOwnProperty(n)&&(i[n]===null?delete e[n]:i[n]instanceof Object?(e[n]=this.getMergedCustomProperties(e[n]instanceof Object?e[n]:{},i[n]),JSON.stringify(e[n])==="{}"&&delete e[n]):e[n]=i[n]);return e}initBrowserStorageUsed(){this.setBrowserStorageUsed(this.isBrowserStorageUsed(!0),!1)}initSession(){const e=this.getStorage(w.session);if(e)try{const i=JSON.parse(e),n=i.mtime?new Date(i.mtime):null;x.isSessionCookieRecent(n,Date.now())&&(this.sessionData={...this.sessionData,...i})}catch{}this.setSource(),this.setUtmParameters(),this.saveSession()}initCustomProperties(){const e=this.getStorage(w.properties);if(e)try{const i=JSON.parse(e);this.customProperties={...this.customProperties,...i}}catch{}}initVisits(){const e=this.getStorage(w.visits);if(e)try{this.visits=JSON.parse(e)}catch{}}initNoShow(){const e=this.getStorage(w.noShow);if(e==="1")this.setDoNotDisplay(!0);else if(e){const i=In(e);!i||x.isNoShowDateReached(i,Date.now())?this.removeStorage(w.noShow):this.noShow=i}}initExternalSubscribed(){this.hasAnySubscription()||(this.getKlaviyoExchangeId()!==null||ge("MCPopupSubscribed")==="yes"||kt("utm_medium")==="email")&&(this.persistentData.sub=1,this.saveStored())}migrateCookieFormat(){let e=!1;(!this.persistentData.v||this.persistentData.v<x.STORAGE_VERSION)&&(e=!0,this.persistentData.v=x.STORAGE_VERSION,delete this.persistentData.version,this.persistentData.csd=this.persistentData.cross_subdomain?1:0,delete this.persistentData.cross_subdomain,this.visits.length===0&&this.persistentData.last_req_date&&this.visits.push(this.persistentData.last_req_date),delete this.persistentData.last_req_date,this.migratePopupsKeys(),this.removeStorage(w.persistent),this.removeStorage(w.properties)),e&&this.save()}migratePopupsKeys(){if(this.persistentData.popins){for(const e in this.persistentData.popins)this.persistentData.popins.hasOwnProperty(e)&&(this.persistentData.popups[e]={d:this.persistentData.popins[e].display_date,dc:this.persistentData.popins[e].display_count},this.persistentData.popins[e].converted&&(this.persistentData.popups[e].c=this.persistentData.popins[e].converted),this.persistentData.popins[e].subscribed&&(this.persistentData.sub=1));delete this.persistentData.popins}this.sessionData.popins&&(this.sessionData.popups=this.sessionData.popins,delete this.sessionData.popins)}setCookie(e,i,n,s="/",o){let r;if(!n||typeof n=="number"){const l=new Date,d=n||this.cookies.ttl;l.setTime(l.getTime()+d*b.msInDay),r=l}let a;const c=Pt(!0);return!o&&this.getCrossSubDomain()&&c.subDomainSkipped&&(a=`.${c.hostname}`),_n(e,i,s||void 0,a,r,this.cookies.maxSize),!0}getStorage(e){return this.isBrowserStorageUsed()?Ot(e):ge(e)}setStorage(e,i,n){return this.isBrowserStorageUsed()?yn(e,i,n):this.setCookie(e,i,n)}testStorage(){const e="wisepops_test",i=this.setStorage(e,"test",!0);return i&&this.removeStorage(e),i}setCrossSubDomain(e){this.persistentData.csd=e?1:0}getCrossSubDomain(){return!!this.persistentData.csd}removeCookie(e){this.setCookie(e,"",-1),this.setCookie(e,"",-1,!1),this.setCookie(e,"",-1,window.location.pathname),this.setCookie(e,"",-1,void 0,!0),this.setCookie(e,"",-1,!1,!0),this.setCookie(e,"",-1,window.location.pathname,!0)}removeStorage(e){this.isBrowserStorageUsed()?Sn(e):this.removeCookie(e)}addSessionPopupId(e,i){const n=i==="bar"?"bars":"popups";this.sessionData[n][e]=0,this.saveSession()}save(){this.saveStored(),this.saveSession(),this.saveCustomProperties(),this.saveVisits(),this.saveNoShow()}saveStored(){try{const e=JSON.stringify(this.persistentData);this.setStorage(w.persistent,e)}catch(e){if(this.getPopupIds().length){const i=this.removeOldestTrackedPopup();z.log(u.warn,"Removing info about popup #"+i+" to make persistent cookie lighter"),this.saveStored()}else throw e}}saveSession(){try{this.sessionData.mtime=new Date().getTime();const e=JSON.stringify(this.sessionData);this.setStorage(w.session,e,!0)}catch(e){if(this.sessionData.src)this.chunkSessionDataSrc(),z.log(u.warn,"Removing URL query to make session cookie lighter"),this.saveSession();else if(Object.keys(this.sessionData.popups).length||Object.keys(this.sessionData.bars).length||Object.keys(this.sessionData.countdowns).length)z.log(u.warn,e),this.sessionData.popups={},this.sessionData.bars={},this.sessionData.countdowns={},this.saveSession();else throw e}}saveCustomProperties(){try{const e=JSON.stringify(this.customProperties);e.length<=2?this.removeStorage(w.properties):this.setStorage(w.properties,e)}catch(e){const i=Object.keys(this.customProperties);if(i.length>0)delete this.customProperties[i[0]],z.log(u.error,`Removing custom property "${i[0]}" to make persistent cookie lighter.`),this.saveCustomProperties();else throw e}}saveVisits(){this.setStorage(w.visits,JSON.stringify(this.visits))}saveNoShow(){this.noShow?this.setStorage(w.noShow,String(this.noShow.getTime())):this.removeStorage(w.noShow)}chunkSessionDataSrc(){if(this.sessionData.src){const e=document.createElement("a");e.href=this.sessionData.src;const i=e.port==="443"||e.port==="80"||!e.port?"":`:${e.port}`;this.sessionData.src=`${e.protocol}//${e.hostname}${i}`}}removeOldestTrackedPopup(){let e=null,i=null;for(const n in this.persistentData.popups)if(this.persistentData.popups.hasOwnProperty(n)){const s=new Date(this.persistentData.popups[n].d);(i===null||s.getTime()<i.getTime())&&(i=s,e=n)}return e&&delete this.persistentData.popups[e],e}generateUcrn(){return this.persistentData.ucrn=Math.floor(Math.random()*100)}setSource(e=document.referrer,i){this.isReferrerExternal(e,i)&&e&&(this.sessionData.src=e,this.saveSession())}setUtmParameters(e){const i=Tt(Ct),n=["gclid"];i.forEach(s=>{let o=s;n.indexOf(o)===-1&&(o="utm_"+o);let r=kt(o,e);r&&(n.indexOf(o)>-1&&(r="yes"),this.sessionData.utm[s]=r)})}incrementSessionPagesElapsedForType(e){for(const i in this.sessionData[e])this.sessionData[e].hasOwnProperty(i)&&this.sessionData[e][i]++}};xt.STORAGE_VERSION=4;let f=xt,Ae;function En(){const t=e=>{e.state&&e.state.wisepops==="exit-intent"&&setTimeout(()=>{(!Ae||!Ae())&&window.history.back()},0)};window.addEventListener("popstate",t)}function Pn(t,e){if(Ae=t,e===1&&!(window.history.state&&window.history.state.wisepops==="normal-intent")){const i=()=>{var s;window.history.replaceState({wisepops:"exit-intent"},""),((s=window.history.state)==null?void 0:s.wisepops)==="exit-intent"&&(window.removeEventListener("touchstart",i),window.removeEventListener("touchend",i),window.history.pushState({wisepops:"normal-intent"},""))};window.addEventListener("touchend",i),window.addEventListener("touchstart",i),("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)&&i()}}const kn=t=>!0;let we;function On(t){we=new CustomEvent(`wisepops.${W.AFTER_INITIALIZATION}`,{detail:{wisepops:t,properties:t._getCustomProperties()},bubbles:!1,cancelable:!1}),document.dispatchEvent(we)}const Tn={get(t,e){return e==="target"?t.detail.target??t.target:typeof t[e]=="function"?(...i)=>t[e](...i):t[e]}};function Dn(t){return function(e){return t(new Proxy(e,Tn))}}function Cn(t,e,i){if(t===W.AFTER_INITIALIZATION&&we){e(we);return}document.addEventListener(`wisepops.${t}`,Dn(e),i)}const Z=B.getInstance();function xn(...t){if(t.length<2){Z.log(u.error,'Method "listen(eventName, popupIdOrListener, [listener])" requires at least 2 parameters');return}const[e,i,n,s]=t,o=Tt(W),r="wisepops.",a=typeof e=="string"&&e.indexOf(r)===0?e.substr(r.length):e;if(typeof a!="string"||!o.includes(a)){Z.log(u.error,`Event ${e} is not a valid WisePops event. Valid events are: 
${o.join(`,
`)}`);return}const c=parseInt(`${i}`,10),l=isNaN(c)?i:n;if(!l){Z.log(u.error,'Method "listen(eventName, popupIdOrListener, [listener])" requires a listener as 2nd or 3rd parameter');return}if(typeof l!="function"){Z.log(u.error,'Method "listen(eventName, popupIdOrListener, [listener])" requires listener to be a function');return}a===W.AFTER_INITIALIZATION&&c&&Z.log(u.warn,`Listening to ${W.AFTER_INITIALIZATION} event does not requires a popupId params. ${c} will be ignored.`),Nt(a,l,c,s)}function Nt(t,e,i,n){Cn(t,i?s=>{s.detail&&s.detail.popup&&s.detail.popup.id!==i||e(s)}:e,n)}const me=(()=>{const t=()=>new Promise(o=>{e=o});let e,i=t(),n;const s=o=>e==null?void 0:e(o);return{setExitHandler:s,getExitHandler:()=>i,setResetExitHandler:o=>n=o,resetExitHandler:()=>{n&&(i=t(),s(n()))}}})(),$e=new Set,Nn=t=>{if(t.e==="d"&&t.p&&$e.delete(t.p),!(!wn.includes(t.e)||!t.p)){if(!$e.has(t.p)){$e.add(t.p);return}t.tc="1"}},Rn=function(t,e){let i=0,n=!1,s;for(s in e){const o=/fields\[(\d+)\]\[(.+)\]/.exec(s);o!=null&&o[1]&&parseInt(o[1],10)===i&&(i=parseInt(o[1],10)+1),o!=null&&o[2]&&o[2]==="tag"&&e[s]==="vuid"&&(n=!0)}return i>0&&!n&&(e[`fields[${i}][name]`]="zaius_vuid",e[`fields[${i}][type]`]="hidden",e[`fields[${i}][value]`]=t,e[`fields[${i}][tag]`]="vuid"),e},_e=function(t,e=()=>null){let i=he.tracking+"/_.gif?";xe.includes(t.e)&&window.zaius&&window.zaius.VUID&&(t=Rn(window.zaius.VUID,t)),xe.includes(t.e)&&t.recaptcha_token||(t.recaptcha_token=void 0);const s=f.getInstance().getTestIp();s&&(t.ip=s),Nn(t);let o;for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&t[o]!==void 0&&(i+=o+"="+encodeURIComponent(t[o])+"&");if(i+="site="+It,i+="&url="+encodeURIComponent(window.location.href.slice(0,1e3)),t.form_session===void 0&&t.discount_block_id===void 0&&navigator.sendBeacon(i))e();else{const r=new XMLHttpRequest;r.addEventListener("load",function(){const a=JSON.parse(this.responseText);a.code&&t.form_session===void 0&&e(a.code||null),e({code:a.code||"",formSession:a.formSession||""})}),r.open("POST",i),r.send()}},Ln=(t,e,i,n)=>{n=n||F.POPUP;const s=f.getInstance();s.setDisplayed(t,n),fe(ue.wisepops_display,{label:e}),_e({e:"d",p:t,banditId:s.getBanditId(String(t)),banditEventId:s.getBanditEventId(String(t))},i)},An=(t,e,i)=>{const n=f.getInstance();n.setConverted(t)&&(fe(ue.wisepops_click,{label:e}),_e({e:"c",p:t,banditId:n.getBanditId(String(t)),banditEventId:n.getBanditEventId(String(t))},i))},$n=(t,e,i,n,s,o,r,a)=>{Ue("s",t,e,i,n,s,o,r,a)},Un=(t,e,i,n,s,o,r,a)=>{Ue("p",t,e,i,n,s,o,r,a)},Mn=(t,e,i,n,s,o,r,a)=>{Ue("e",t,e,i,n,s,o,r,a)},Ue=(t="e",e,i,n,s,o,r,a,c)=>{const l=h=>{switch(h){case"s":return pe.survey;case"p":return pe.phone;default:return pe.email}},d=f.getInstance();if(d.setConverted(e)&&d.setSubscribed(e)){fe(ue.wisepops_form_submit,{label:i,form_type:l(t)});const h={...c,e:t,p:e,banditId:d.getBanditId(String(e)),banditEventId:d.getBanditEventId(String(e))};n&&s.unshift({name:"email",type:"email",value:n}),r&&(h.recaptcha_token=r),a&&(h.discount_block_id=a);for(let g=0;g<s.length;g++)h["fields["+g+"][name]"]=""+s[g].name,h["fields["+g+"][value]"]=""+s[g].value,typeof s[g].type=="string"&&(h["fields["+g+"][type]"]=""+s[g].type),s[g].tag!==null&&s[g].tag!==void 0&&(h["fields["+g+"][tag]"]=""+s[g].tag);_e(h,o)}},L={_trackDisplay:Ln,_trackClick:An,_trackSignup:Mn,_trackSurvey:$n,_trackPhone:Un,_hasFeature:kn,_isConverted:t=>f.getInstance().isConverted(t),_getPageViewCount:()=>f.getInstance().getPageViewCount(),_getArrivalOnPage:()=>f.getInstance().getArrivalOnPage(),_isPhoneDevice:()=>f.getInstance().isPhoneDevice(),_isTabletDevice:()=>f.getInstance().isTabletDevice(),_getUserLocation:()=>f.getInstance().getUserLocation(),_getTrafficChannel:()=>f.getInstance().getTrafficChannel(),_getUserIp:()=>f.getInstance().getUserIp(),_getSource:()=>f.getInstance().getSource(),_getSourceDomain:()=>f.getInstance().getSourceDomain(),_getUTMParameters:()=>f.getInstance().getUtmParameters(),_getCustomProperties:t=>f.getInstance().getCustomProperties(t),_setTimerStarted:t=>f.getInstance().setTimerStarted(t),_getTimerStartedAt:t=>f.getInstance().getTimerStartedAt(t),_setDoNotDisplay:()=>f.getInstance().setDoNotDisplay(),_getDoNotDisplay:()=>f.getInstance().getDoNotDisplay(),_setClosed:t=>f.getInstance().setClosed(t),_enableStickyTab:t=>f.getInstance().enableStickyTab(t),_disableStickyTab:t=>f.getInstance().disableStickyTab(t),_isStickyTab:t=>f.getInstance().isStickyTab(t),_setStickyTabData:(t,e,i)=>f.getInstance().setStickyTabData(t,e,i),_getStickyTabData:(t,e)=>f.getInstance().getStickyTabData(t,e),_setStickyTabFormSession:(t,e)=>f.getInstance().setStickyTabFormSession(t,e),_getStickyTabFormSession:t=>f.getInstance().getStickyTabFormSession(t),_setStickyTabStep:(t,e)=>f.getInstance().setStickyTabStep(t,e),_getStickyTabStep:t=>f.getInstance().getStickyTabStep(t),_getStickyTabUniqueCoupon:t=>f.getInstance().getStickyTabUniqueCoupon(t),_setStickyTabUniqueCoupon:(t,e)=>f.getInstance().setStickyTabUniqueCoupon(t,e),_log:(...t)=>B.getInstance().log(...t),_setExitHandler:me.setExitHandler,_getExitHandler:me.getExitHandler,_resetExitHandler:me.resetExitHandler,_setResetExitHandler:me.setResetExitHandler,_registerBackExitTrigger:t=>Pn(t,f.getInstance().getPageViewCount()),_listen:Nt,_registerBundle:t=>ls(t),_getRecaptchaSiteKey:()=>f.getInstance().getRecaptchaSiteKey()},Bn=t=>{const e=`.observer-pixel-${t}`;if(document.querySelector(e))return e;const n=`<div class="observer-pixel-${t}"><style>
${e}{width: 1px;height: 1px;position: absolute;left: 0;margin-top: 100vh;top: ${t}%; pointer-events: none;}
</style></div>`;return document.body.insertAdjacentHTML("beforeend",n),e},Fn=(t,e,i)=>{const n=document.querySelectorAll(e);if(!n.length)return;const s=new IntersectionObserver(t,i);return n.forEach(o=>s.observe(o)),s};function jn(t){const e=t.sensitivity??20,i=t.timer??1e3,n=t.delay??0,s=t.callback,o=document.documentElement;let r=null,a=!1;function c(O){a||!O.metaKey||O.keyCode!==76||(a=!0,r=setTimeout(p,n))}function l(){r&&(clearTimeout(r),r=null)}function d(O){O.clientY>e||(r=setTimeout(p,n))}function h(){o.addEventListener("mouseleave",d),o.addEventListener("mouseenter",l),o.addEventListener("keydown",c)}setTimeout(h,i);function g(){o.removeEventListener("mouseleave",d),o.removeEventListener("mouseenter",l),o.removeEventListener("keydown",c)}function p(){s(),g()}return{fire:p,disable:g}}let Rt=window.innerHeight<window.innerWidth,Lt=window.innerHeight;const Vn=t=>{const e=()=>{const i=window.innerHeight<window.innerWidth;Rt===i&&window.innerHeight<Lt&&(window.removeEventListener("resize",e),t()),Rt=i,Lt=window.innerHeight};window.addEventListener("resize",e)},At=({triggerExitScrollup:t,lazy:e})=>{const i=()=>new Promise(s=>{let o=!1;const r=()=>{o||(s(),o=!0)};jn({callback:r}),(L._isPhoneDevice()||L._isTabletDevice())&&(t&&Vn(r),L._registerBackExitTrigger(()=>o?!1:(r(),!0)))}),n=i();return L._setResetExitHandler(i),L._setExitHandler(n),e?n:Promise.resolve()},Me=1e3,Hn=5*Me,Gn=.5*Me,qn=-1,Wn="50%",zn="100%",Kn=window.requestIdleCallback??(t=>t()),ye=(t,e={rootMargin:Wn})=>{let i;return t?new Promise(n=>{try{i=Fn(Zn(n),t,e)}catch{n("fallback")}}).then(()=>i==null?void 0:i.disconnect()):Promise.resolve()},Jn=({popupType:t,selector:e})=>t==="embed"?ye(e,{rootMargin:zn}):Promise.resolve(),$t=({delay:t,...e})=>t&&!L._isStickyTab(e.popupId)?new Promise(i=>setTimeout(i,t*Me-Gn-(Date.now()-L._getArrivalOnPage().getTime()))):Jn(e),Yn=()=>new Promise(t=>Kn(()=>setTimeout(t,Hn))),Xn=()=>Promise.resolve(),Zn=t=>e=>{var i;(i=e[0])!=null&&i.isIntersecting&&t(!0)},Qn={landing:$t,exit:async t=>(t.delay&&await $t(t),At(t)),scroll:({triggerScrollPercent:t})=>t?ye(Bn(qn+Number(t)),{}):Promise.resolve(),hover:({triggerHoverElement:t})=>ye(`#${t}`),click:({triggerClickAnchor:t})=>ye(`[href*='${t}']`)};async function es(t,e){return Promise.race([(Qn[t.trigger]??Xn)(t),Yn(),e])}const ts={[F.BAR]:1,[F.POPUP]:1,[F.EMBED]:1/0,[F.STICKY]:1},E={};function is(t){Q(t.popupId)||(E[t.popupId]={details:{...t,weight:Be(t)}})}function ns(t,e,i){const n=document.createElement("script");n.type="text/javascript",n.async=!0,n.setAttribute("charset","UTF-8"),n.src=`${he.cdn}/shared/wisepops/${t}/${e}.js?v=${encodeURIComponent(i)}`,document.body.appendChild(n)}function ss(t,e){const{popupId:i,popupType:n,popupVersion:s}=t;if(Q(i))os(i);else{E[i]={details:{popupId:i,popupVersion:s,popupType:n,weight:Be(t)}};const o=new Promise((r,a)=>{E[i].cancelLoading=a});es(t,o).then(()=>ns(e,i,s),()=>B.getInstance().log("info",`Campaign ${i}: loading was cancelled`))}}function os(t){var i;const e=(i=E[t])==null?void 0:i.bundle;if(!e)throw new Error(`No bundle for popup #${t}. You need to load it first.`);e.start()}function rs(t){var e,i,n,s;(i=(e=E[t])==null?void 0:e.bundle)==null||i.destroy(),(s=(n=E[t])==null?void 0:n.cancelLoading)==null||s.call(n),delete E[t]}function Q(t){var e;return!!((e=E[t])!=null&&e.bundle)}function Be(t){return t.triggerClickAnchor?0:1}function as(t){return Object.keys(E).reduce((e,i)=>{var n,s;return((s=(n=E[i])==null?void 0:n.details)==null?void 0:s.popupType)===t?E[i].details.weight+e:e},0)}function cs(t){const e=Be(t);return e===0?!1:as(t.popupType)+e>ts[t.popupType]}function ls(t){E[t.popupId]?E[t.popupId].bundle=t:t.destroy()}function Ut(t){Object.keys(E).forEach(e=>{t(E[e])&&rs(e)})}const j={};let Fe=!1;function ds(){Fe||(Fe=!0,setTimeout(()=>{Object.keys(j).forEach(t=>{const e=j[t];if(e){const i=document.querySelector(t);i&&(e.forEach(n=>n(i)),delete j[t])}}),Object.keys(j).length===0&&je.disconnect(),Fe=!1},500))}const je=new MutationObserver(ds);function us(t){const e=document.querySelector(t);return e?Promise.resolve(e):new Promise(i=>{let n=j[t];n||(n=new Set,j[t]=n),n.add(i),je.observe(document,{subtree:!0,childList:!0,attributes:!0})})}function Mt(t){return us(t)}function ps(){Object.keys(j).forEach(t=>delete j[t]),je.disconnect()}let Se;function fs(t){return Se&&!t.e&&Se.abort(),new Promise((e,i)=>{const n=he.popup+"/my-wisepop";let s="";for(const r in t)t.hasOwnProperty(r)&&(s+=r+"="+encodeURIComponent(t[r])+"&");s.length&&(s=s.slice(0,-1));let o=null;if(XMLHttpRequest&&(o=new XMLHttpRequest,!o))throw new Error("Your browser does not support XHR");o&&(t.e||(Se=o),o.onload=function(){t.e||(Se=void 0),e(JSON.parse(this.responseText))},o.onerror=i,o.open("POST",n,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.setRequestHeader("Accept","application/json"),o.send(s))})}const ee=B.getInstance();function hs(t,e){const i="Resolving display scenarios for "+(e?'custom event "'+e+'"':"pageview"),n=t.getCustomProperties(!0);ee.log(u.info,i,n||void 0);const s={cid:X,site:It,ucrn:t.getUcrn(),url:document.location.toString(),pageviews:t.getPageViewCount(),v:t.getVisits().join(","),lv:1},o=t.getTestIp();o&&o.length&&(s.ip=o);const r=t.getAllRecommendations();Object.keys(r).forEach(p=>{s[`bandit[${p}]`]=r[p]});const a=t.getSource();a&&(s.src=a),e&&(s.e=e);const c=t.getKlaviyoExchangeId();c&&(s.kx=c);const l=t.getExternalSegments();l!==void 0&&(s.es=l),t.getPopupIds()&&t.getPopupIds().forEach(O=>{s["d["+O+"]"]=t.getLastDisplayedInterval(O),t.isConverted(O)&&(s["c["+O+"]"]=1),s["dc["+O+"]"]=t.getDisplayCount(O),t.isClosed(O)&&(s["cl["+O+"]"]=1)});const d=t.getSessionPopups();for(const p in d)d.hasOwnProperty(p)&&(s["ds["+p+"]"]=d[p]);const h=t.getSessionBars();for(const p in h)h.hasOwnProperty(p)&&(s["dbs["+p+"]"]=h[p]);s.skt=t.getSessionStickyTabs().join(","),t.hasAnySubscription()&&(s.sub=1);const g=t.getUtmParameters();for(const p in g)g.hasOwnProperty(p)&&(s["utm["+encodeURIComponent(p)+"]"]=g[p]);if(n)for(const p in n)n.hasOwnProperty(p)&&(s["p["+encodeURIComponent(p)+"]"]=n[p]);return s}function gs(t,e,i){if(t.status==="ok"){t.popups.length>0?ee.log(u.info,"Matched popups: "+JSON.stringify(t.popups)):ee.log(u.info,"No matching scenario");const n=Et.knuthShuffle(t.popups.filter(o=>o.type!==F.STICKY)),s=t.popups.filter(o=>o.type===F.STICKY);if(s.sort((o,r)=>{const a=e.getPopup(parseInt(o.id,10)),c=e.getPopup(parseInt(r.id,10));if(!a||!c)return 1;const l=a.c&&typeof a.c=="number"?a.c+1e9:a.d,d=c.c&&typeof c.c=="number"?c.c+1e9:c.d;return l<d?1:-1}),n.push(...s),i){const o=n.map(({type:r})=>r);Ut(({details:{popupType:r,popupId:a}})=>Q(a)?n.some(({id:c})=>c===a)?!1:o.includes(r):!0)}else document.dispatchEvent(new CustomEvent("wisepops.internal",{detail:{action:"DESTROY_POPUP"}})),Ut(({details:{popupId:o}})=>Q(o)?!n.some(({id:r})=>r===o):!0);n.forEach(async({id:o,v:r,type:a,...c})=>{const l={...c,popupId:o,popupVersion:r,popupType:a};if(Q(l.popupId)||!cs(l)){is(l);const d=[];c.triggerClickAnchor&&d.push(Mt(`[href$="${c.triggerClickAnchor}"]`)),c.selector&&d.push(Mt(c.selector)),await Promise.all(d),ee.log(u.info,"Loading popup: "+JSON.stringify(c)),c.campaignId&&!e.getRecommendationId(c.campaignId)&&e.setRecommendationId(c.campaignId,Number(c.id)),c.banditEventId&&e.setBanditEventId(c.id,c.banditEventId),c.banditId&&e.setBanditId(c.id,c.banditId),ss(l,c.hash??t.hashPath)}}),t.device!==void 0&&e.setDevice(t.device),t.location!==void 0&&e.setUserLocation(t.location),t.recaptcha_site_key&&e.setRecaptchaSiteKey(t.recaptcha_site_key),t.externalSegments!==void 0&&e.setExternalSegments(t.externalSegments),e.setTrafficChannel(t.traffic_channel||null),t.ip&&e.setUserIp(t.ip)}else if(t.status==="error")throw new Error(t.message||"An internal error occurred")}async function Bt(t,e){const i=hs(t,e);ps();try{gs(await fs(i),t,!!e)}catch(n){ee.log(u.error,n)}}const Ft=B.getInstance(),m=Ft.log.bind(Ft),ws=["string","number","boolean"];class ms{constructor(){this.pageviewCalled=!1,this.loggerDisplayLevel=null,this.storage=f.getInstance(),this.loggerDisplayLevel===null&&this.logAction(u.error)}defaultPageView(){!this.pageviewCalled&&this.storage.getAutoPageView()&&this.pageviewAction()}logAction(e){B.getInstance().displayAll(e)}eventAction(e){!e||typeof e!="string"?m(u.error,'Method "event" requires an event name as 2nd parameter'):(e.length>50&&(m(u.warn,"The event name cannot exceed 50 characters"),e=e.substr(0,50)),Bt(this.storage,e))}pageviewAction(){var i;const e=window[window.wisepops_key];this.storage.setArrivalOnPage(e.l),this.pageviewCalled||(this.storage.setArrivalOnSite(),this.storage.addVisit()),this.storage.incrementPageViewCount(this.pageviewCalled),this.storage.incrementSessionPagesElapsed(),(i=e._resetExitHandler)==null||i.call(e),Bt(this.storage),this.pageviewCalled=!0}goalAction(e,i=null){e&&typeof e!="string"?(m(u.error,'Method "goal" accepts a goal name as optional 2nd parameter'),e=null):e&&e.length>50&&(m(u.warn,"The goal name cannot exceed 50 characters"),e=e.substr(0,50)),typeof i=="string"&&(i=parseFloat(i)),i&&isNaN(i)&&(m(u.error,'Method "goal" accepts a revenue amount as optional 3rd parameter'),i=null),i&&i>1e6&&(m(u.warn,"The revenue cannot exceed 1,000,000"),i=1e6);let n="Tracking goal";e&&(n+=' named "'+e+'"'),i&&(n+=' with revenue "'+i+'"'),m(u.info,n);const s=this.storage.getLastDisplayedAndConvertedPopups();if(s.displayPopId||s.convertPopId){const o={e:"g"};e&&(o.n=e),i&&(o.r=i),s.displayPopId&&(o.pd=s.displayPopId,o.dd=s.displayDate.toJSON()),s.convertPopId&&(o.pc=s.convertPopId,o.dc=s.convertDate.toJSON()),_e(o)}}propertiesAction(e,i){if(!e||!(e instanceof Object))m(u.error,'Method "properties" requires an object as 2nd parameter');else{const n=this.validateProperties(e,typeof i=="object"&&i.temporary);this.storage.setCustomProperties(n,i)}}optionsAction(e){Object.keys(e).map(i=>{switch(i){case"browserStorage":this.browserStorageOption(e[i]);return;case"cookieMaxSize":this.cookieMaxSizeOption(e[i]);return;case"cookieTTL":this.cookieTTLOption(e[i]);return;case"autoPageview":this.autoPageviewOption(e[i]);return;case"testIp":this.testIpOption(e[i]);return;default:m(u.error,`Unknown option "${i}"`)}})}dispatch([e,...i]){switch(m(u.debug,`Processing ${e} with`,i),e){case"listen":xn(...i);break;default:const n=e+"Action";!e||!this[n]?m(u.error,'Unknown method "'+e+'"'):this[n](...i)}}validateProperties(e,i){const n={};for(const s in e)e.hasOwnProperty(s)&&(e[s]===null||e[s]===void 0||e[s]instanceof Object&&JSON.stringify(e[s])==="{}"?n[s]=null:this.isValidProperty(e[s])?s.length>50||!i&&e[s].toString().length>255?m(u.error,'Property "'+s+'" is too long'):e[s]instanceof Date?n[s]=e[s].toJSON():e[s]instanceof Object?n[s]=this.validateProperties(e[s],i):n[s]=e[s]:m(u.error,'Property "'+s+'" cannot be an instance of "'+typeof e[s]+'"'));return n}isValidProperty(e){return ws.indexOf(typeof e)>-1||e instanceof Date||e instanceof Object&&!(e instanceof Array)}browserStorageOption(e){try{this.storage.setBrowserStorageUsed(!!e,!0)&&m(u.info,"Browser storage has been "+(e?"enabled":"disabled"))}catch(i){m(u.warn,i)}}cookieMaxSizeOption(e){e=Number(e),!Number.isInteger(e)||e<b.cookieMaxSizeMin||e>b.cookieMaxSizeMax?m(u.warn,"cookieMaxSize must be an integer between "+b.cookieMaxSizeMin+" and "+b.cookieMaxSizeMax):this.storage.isBrowserStorageUsed()?m(u.warn,"cookieMaxSize option is ignored when using browser storage"):(this.storage.setCookiesMaxSize(e),m(u.info,"Cookie max size set to "+e+"B"))}autoPageviewOption(e){typeof e!="boolean"&&m(u.warn,"autoPageview option must be a boolean value"),this.storage.setAutoPageView(e)}cookieTTLOption(e){e=Number(e),!Number.isInteger(e)||e<b.cookieTTLMin||e>b.cookieTTLMax?m(u.warn,"cookieTTL must be an integer between "+b.cookieTTLMin+" and "+b.cookieTTLMax):this.storage.isBrowserStorageUsed()?m(u.warn,"cookieTTL option is ignored when using browser storage"):(this.storage.setCookiesTTL(e),m(u.info,"Cookie TTL set to "+e+" days"))}testIpOption(e){e.length>6&&e.length<41?this.storage.setTestIp(e):m(u.error,`Invalid IP address provided "${e}"`)}}const ve=new ms,jt=B.getInstance(),be=jt.log.bind(jt),K=f.getInstance(),_s=async t=>{var i;let e;try{e=window.self!==window.top&&!((i=window.Shopify)!=null&&i.designMode)}catch{e=!0}if(e){be(u.info,"Disabled inside iframe");return}else if(navigator.cookieEnabled){if(K.getDoNotDisplay()){be(u.info,"Disabled for 30 days");return}}else{be(u.error,"Cookies need to be enabled");return}En(),ys(t),bs(t),window.__WISEPOPS_TESTS__&&Ss(t,ve),vs(t),On(t)};function ys(t){Object.keys(L).forEach(e=>{t[e]=L[e]}),window.__WISEPOPS_ALLOW_DEBUG__&&(t._getDebugData=()=>K.getDebugData())}function Ss(t,e){t.__tests__={storage:K,api:e}}function vs(t){const e=i=>{if(typeof i=="function")try{i(t)}catch(n){be(u.error,"LoaderCallback - "+n)}};e(window.WisePopsLoaderCallback),Object.defineProperty(window,"WisePopsLoaderCallback",{set:e})}function bs(t){t.isPreviewMode=window.__WISEPOPS_PREVIEW_MODE__,t._api={trackSignup:t._trackSignup,trackDisplay:t._trackDisplay,trackClick:t._trackClick,log:t._log,registerBackExitTrigger:t._registerBackExitTrigger},t._storage={isConverted:t._isConverted,getPageViewCount:t._getPageViewCount,getArrivalOnPage:t._getArrivalOnPage,getUserLocation:t._getUserLocation,getTafficChannel:t._getTrafficChannel,getUserIp:t._getUserIp,getSource:t._getSource,getSourceDomain:t._getSourceDomain,getUTMParameters:t._getUTMParameters,isPhoneDevice:t._isPhoneDevice,isTabletDevice:t._isTabletDevice,setDoNotDisplay:t._setDoNotDisplay,getDoNotDisplay:t._getDoNotDisplay},window.wiseStorage={isConverted(e){return K.isConverted(e)},setConverted(e){return K.setConverted(e)},setDisplayed(e,i){return K.setDisplayed(e,i)},_getObj(){return window[window.wisepops_key]}},window.WisepopsAddToCookiePage=()=>{}}const Is=()=>{const t=document.createElement("script");t.async=!0,t.src=`${Ee}/toolbelt.js?h=${A}`,document.head.appendChild(t)},Es="wisepops-setup",Ps=window.requestIdleCallback??setTimeout,ks=()=>new URLSearchParams(document.location.search).get(Es)!==null,Os=()=>{Ps(()=>{ks()&&Is()})},Ts=()=>{var e,i;return!(window.ShopifyAnalytics!==void 0)||!qe.includes("RECOMMENDATIONS_FEED")?{}:{product:(i=(e=window.ShopifyAnalytics)==null?void 0:e.meta)!=null&&i.product?window.location.pathname.split("/").pop():void 0}},Ds=()=>({...Ts()});let Ie;try{Ie=JSON.parse(atob(Zt))}catch{console.error("Failed to parse Wisepops goals"),Ie=[]}const Cs=t=>{const e=Ie.filter(({type:i})=>i==="URL");for(const i of e)if(t.includes(i.trackUrl))return i;return null},xs=t=>{t.q=t.q||[];const e=t.q.push;t.q.push=i=>t.q.length>0?e.apply(t.q,[i]):(Vt(i),0)},Ns=t=>{const e=t.q;e.forEach(i=>{Vt(i)}),e.length=0},Vt=t=>{if(t.length===0)return;const[e,...i]=Array.from(t);if(typeof e=="string")switch(e){case"goal":Rs(...i);break;default:ve.dispatch([e,...i])}},Rs=(...t)=>{const e=t[0]??null,i=t[1]??null,n=Ie.find(({hash:o})=>o===e);if(n===void 0){ve.goalAction(e,typeof i=="number"||typeof i=="string"?i:null);return}let s;typeof i=="object"&&i!==null&&"revenue"in i&&typeof i.revenue=="number"&&(s=i.revenue*100),S(y.CONVERSION,{goalId:n.hash,revenueCents:s})},Ls=(t,e=300)=>{let i;return(...n)=>{clearTimeout(i),i=setTimeout(()=>t(...n),e)}},As=t=>{let e=window.location.hostname+window.location.pathname;new MutationObserver(()=>{const i=window.location.hostname+window.location.pathname;e!==i&&(e=i,t())}).observe(document,{childList:!0,subtree:!0})},Ht=async()=>{if(qe.includes("VISITOR_ID")){const e=Ds();await di(e)}else ni();S(y.PAGEVIEW,{title:document.title});const t=Cs(window.location.href);t&&S(y.CONVERSION,{goalId:t.hash,revenueCents:t.attributeRevenue??void 0})},$s=async()=>{window.wisepops_key=window.WisePopsObject=window.wisepops_key||window.WisePopsObject||"wisepops";const t=window[window.wisepops_key];xs(t),await Ht(),await _s(t),fi(),fn(),Os(),As(Ls(Ht)),Ns(t),ve.defaultPageView()};(window.wisepops_started??!1)||(window.wisepops_started=!0,$s().catch(t=>{console.error(t)}))})();
